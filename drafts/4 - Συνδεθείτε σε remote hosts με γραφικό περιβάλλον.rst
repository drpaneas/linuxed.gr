:Title: Συνδεθείτε σε remote hosts με γραφικό περιβάλλον
:Date: 2015-01-17 19:20
:Tags: vnc, ssh, xorg
:Category: howto
:Slug: sundetheite-se-remote-hosts-me-grafiko-perivallon
:Author: Πανος Γεωργιαδης

Αρκετές φορές έχουμε έρθει -- λίγο/πολύ -- όλοι μας σε μία κατάσταση στην οποία πρέπει να συνδεθούμε απομακρυσμένα σε κάποιον host. Αυτός ο host μπορεί να είναι το PC "κάποιου φίλου", ο homeserver, ή ο,τιδήποτε. Αυτό που μας ενδιαφέρει είναι ότι όλοι αυτοί οι hosts τρέχουν κάποια έκδοση του Linux, γεγονός που μας επιτρέπει να συνδεθούμε απομακρυσμένα σε αυτούς μέσω SSH. Σ' αυτό το άρθρο, θα αναφερθούμε στο "πώς" μπορεί κανείς να κάνει initialize μία graphical session και να την διοχευτεύσει μέσα από το SSH Tunnel. Έτσι θα μάθετε να χρησιμοποιείτε 100% open source εργαλεία και δεν θα χρειάζεται να ψάχνετε στο Google για να κατεβάσετε την δωρεάν έκδοση του ... Team Viewer.

Λίγα λόγια για τον X
====================

Το πρώτο πράγμα που έχουμε να κάνουμε είναι να σιγουρευτούμε ότι ο **X** είναι εγκατεστημένος στο απομακρυσμένο μηχάνημα και γνωρίζουμε
ποιος είναι ο ρόλος του σε ένα σύστημα Linux.

X
  Το Xorg, X.org, X Server ή απλά X, είναι ένα client/server protocol της *κακιάς ώρας* με πάρα πολλά προβλήματα.
  Παρόλα αυτά, το χρησιμοποιούμε ακόμα και σήμερα γιατί δεν υπάρχει κάτι καλύτερο. Αυτό που κάνει είναι να παρέχει
  υπηρεσίες GUI στο Linux. Δουλεύει μέσω δικτύου, δηλαδή είναι ένα binary πλήρως συμβατό TCP/IP protocol.

Αυτό που φαίνεται να μην καταλαβαίνει αρκετός κόσμος που ασχολείται με το Linux, είναι ότι στο το **βασικό interface** αλληλεπίδρασης
του συστήματος με τον χρήστη είναι η γραμμή εντολών ή αλλιώς το **shell** (``/bin/sh`` ή ``/bin/bash``).
Οπότε το *νορμάλ* για το Linux είναι να ανοίγει *headless*, δηλαδή χωρίς γραφικό περιβάλλον.

Αντίθετα, στα *Microsoft Windows*, το βασικό interface αλληλεπίδραση με τον χρήστη είναι το GUI, συνεπώς αν δεις ότι
ο υπολογιστής σου δεν μπουτάρει απευθείας σε γραφικό περιβάλλον, τότε υπάρχει πρόβλημα. Για αυτό άλλωστε και οι χρήστες
Windows φοβούνται την γραμμή εντολών (Command Line Interface ή CLI), αφού την έχουν συνδέσει το μυαλό τους με κάτι
κακό/ανεπιθύμητο.

Πριν προχωρήσουμε, πρέπει να καταλάβετε ότι το γραφικό περιβάλλον στο Linux δεν είναι παρά ένα ακόμα πρόγραμμα τύπου Client/Server, όπως
οποιοδήποτε άλλο. Σκεφτείτε τον **Firefox**, ο οποίος είναι ένας *browser*, δηλαδή ένας client που στέλνει HTTP Requests
στην TCP/IP 80 Port του απομακρυσμένου Webserver. Στην συνέχεια, ο Webserver αποδέχεται το request και απαντάει σερβίροντας (εξού και η λέξη
"*server*") την HTML page, η οποία γίνεται render στον browser. Με την ίδια φιλοσοφία λειτουργεί και ο X. Ο  X Client στέλνει το request
ζητώντας να γίνουν render τα γραφικά, ο X Server το λαμβάνει και το στέλνει είτε στο OpenGL είτε απευθείας στην κάρτα γραφικών (ή CPU). Αφού
γίνει το hardware process των γραφικών, στέλνονται στην οθόνη, η οποία παίζει τον ρόλο του browser στην προκειμένη περίπτωση. Όπως ο browser
απεικονίζει την HTML, έτσι και η οθόνη απεικονίζει τα γραφικά.

Προσέξτε τον όρο "οθόνη", καθώς δεν αναφέρομαι στην οθόνη ως συσκευή, αλλά στην οθόνη ως μεταβλητή. Βλέπετε ο X Server μπορεί να τρέξει σε
πολλές οθόνες, οπότε κάθε φορά που ξεκινάει σετάρει εκ νέου μία μεταβλητή, η οποία λέγεται ``DISPLAY``. Περισσότερα για αυτήν θα πούμε στην
συνέχεια καθώς παίζει **τεράστιο** ρόλο στην κατανόηση του όλου *concept*.

Ξεκινώντας τον X Server στην display 1
======================================
Για να καταλάβετε τι συμβαίνει θα πρέπει να εφαρμόσετε τα παρακάτω σε έναν απομακρυσμένο server ο οποίος δεν είναι και τόσο απομακρυσμένος.
Δηλαδή θέλω να έχετε φυσική πρόσβαση, ώστε να μπορείτε να  δείτε τι συμβαίνει στην οθόνη του remote host. Μπορείτε να φτιάξετε στα γρήγορα
ένα VM, βάζοντας bridge mode στο δίκτυο, ώστε να μπορείτε να το κάνετε ping/ssh/κλπ μέσω του host OS. Ο σκοπός του άρθρου δεν είναι να σας
δείξει πως να εγκαταστήσετε το VNC ή πως να το χρησιμοποιήσετε, αλλά να δείτε πως δουλεύει το VNC.


Inderect Rendering
------------------

Στην προκειμένει περίπτωση, όπου είμαστε συνδεμένοι απομακρυσμένα, μας ενδιαφέρει να χρησιμοποιήσουμε τις δυνατότητες επιτάχυνσης γραφικών
του δικού μας υπολογιστή, και όχι του απομακρυσμένου host. Οπότε αυτό που θέλουμε είναι να στείλουμε request στον X Server, αυτός με την
σειρά του να την στείλει στο OpenGL ώστε να χρησιμοποιηθεί το GLX protocol, και το GLX να την στείλει στην κάρτα γραφικών. Από την στιγμή
που είμαστε συνδεμένοι με SSH και έχουμε ενεργοποιημένο το X11 Forwarding, το GLX θα στείλει τις εντολές στην εκάστωτε ``DISPLAY``, η οποία
γίνεται και αυτή με την σειρά της Forward. Συνεπώς, το όλο rendering γίνεται locally στον δικό μας υπολογιστή και όχι στον απομακρυσμένο.

Direct Rendering
----------------

Αν θέλουμε να πετύχουμε το αντίθετο, δηλαδή να χρησιμοποιήσουμε το hardware του απομακρυσμένου host για το rendering των γραφικών,
τότε αρκεί να πούμε στον X Server να στείλει τις εντολές απευθείας στο Hardware, χωρίς να μεσολαβίσει το abstraction layer του OpenGL.

Πώς γνωρίζω τι από τα δύο χρησιμοποιώ;
--------------------------------------

Μπορείτε να δείτε την env μεταβλητή
καθώς επίσης αν τρέξετε το `glxgears` θα δείτε κάποια errors. Προσοχή, καθώς αυτα τα errors έχουν γίνει deprecated σε συστήματα
που χρησιμοποιούν systemd.

Τα πακέτα που πρέπει να έχετε για να ξεκινήσει ο X είναι:

- xorg-x11-fonts
- xorg-x11-server
- xorg-x11-xinit

Τα πακέτα που πρέπει να έχετε για να κάνετε απομακρυσμένη σύνδεση με τον X είναι:

- xorg-x11-Xvnc
- tightVNC

Σημείωση: Το Ubuntu χρησιμοποιεί την δική του ονοματολογία αλλά και configuration, σε σημείο που δεν σχετίζεται
	  ούτε με το Debian. Θα χρειαστείτε λοιπόν το πακέτο ``vnc4server`` το οποίο είναι το αντίστοιχο του ``TightVNC``.

Behind the Machine
==================
Για να καταλάβετε τι συμβαίνει θα πρέπει να εφαρμόσετε τα παρακάτω σε έναν απομακρυσμένο server ο οποίος δεν είναι και τόσο απομακρυσμένος.
Δηλαδή θέλω να έχετε φυσική πρόσβαση, ώστε να μπορείτε να  δείτε τι συμβαίνει στην οθόνη του remote host. Μπορείτε να φτιάξετε στα γρήγορα
ένα VM, βάζοντας bridge mode στο δίκτυο, ώστε να μπορείτε να το κάνετε ping/ssh/κλπ μέσω του host OS. Ο σκοπός του άρθρου δεν είναι να σας
δείξει πως να εγκαταστήσετε το VNC ή πως να το χρησιμοποιήσετε, αλλά να δείτε πως δουλεύει το VNC.

```python
a = b
d = 3
if loop
for
()
```


::

    for a in [5,4,3,2,1]:   # this is program code, shown as-is
        print a
    print "it's..."
    # a literal block continues until the indentation ends

This text has returned to the indentation of the first paragraph,
is outside of the literal block, and is therefore treated as an
ordinary paragraph.

